<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Time Series Regression and Exploratory Data Analysis | Time Series Analysis and Its Applications</title>
  <meta name="description" content="This book aims to provide my results to the different problems within Time Series Analysis and Its Application, with R examples, by Robert H. Shumway and David S. Stoffer" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Time Series Regression and Exploratory Data Analysis | Time Series Analysis and Its Applications" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book aims to provide my results to the different problems within Time Series Analysis and Its Application, with R examples, by Robert H. Shumway and David S. Stoffer" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Time Series Regression and Exploratory Data Analysis | Time Series Analysis and Its Applications" />
  
  <meta name="twitter:description" content="This book aims to provide my results to the different problems within Time Series Analysis and Its Application, with R examples, by Robert H. Shumway and David S. Stoffer" />
  

<meta name="author" content="Steven Golovkine" />


<meta name="date" content="2021-01-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="characteristics-of-time-series.html"/>
<link rel="next" href="methods.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Time Series Analysis and Its Applications</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html"><i class="fa fa-check"></i><b>2</b> Characteristics of Time Series</a>
<ul>
<li class="chapter" data-level="2.1" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices"><i class="fa fa-check"></i><b>2.1</b> Exercices</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.1"><i class="fa fa-check"></i><b>2.1.1</b> Exercices 1.1</a></li>
<li class="chapter" data-level="2.1.2" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.2"><i class="fa fa-check"></i><b>2.1.2</b> Exercices 1.2</a></li>
<li class="chapter" data-level="2.1.3" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.3"><i class="fa fa-check"></i><b>2.1.3</b> Exercices 1.3</a></li>
<li class="chapter" data-level="2.1.4" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.4"><i class="fa fa-check"></i><b>2.1.4</b> Exercices 1.4</a></li>
<li class="chapter" data-level="2.1.5" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.5"><i class="fa fa-check"></i><b>2.1.5</b> Exercices 1.5</a></li>
<li class="chapter" data-level="2.1.6" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.6"><i class="fa fa-check"></i><b>2.1.6</b> Exercices 1.6</a></li>
<li class="chapter" data-level="2.1.7" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.7"><i class="fa fa-check"></i><b>2.1.7</b> Exercices 1.7</a></li>
<li class="chapter" data-level="2.1.8" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.8"><i class="fa fa-check"></i><b>2.1.8</b> Exercices 1.8</a></li>
<li class="chapter" data-level="2.1.9" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.9"><i class="fa fa-check"></i><b>2.1.9</b> Exercices 1.9</a></li>
<li class="chapter" data-level="2.1.10" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.10"><i class="fa fa-check"></i><b>2.1.10</b> Exercices 1.10</a></li>
<li class="chapter" data-level="2.1.11" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.11"><i class="fa fa-check"></i><b>2.1.11</b> Exercices 1.11</a></li>
<li class="chapter" data-level="2.1.12" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.12"><i class="fa fa-check"></i><b>2.1.12</b> Exercices 1.12</a></li>
<li class="chapter" data-level="2.1.13" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.13"><i class="fa fa-check"></i><b>2.1.13</b> Exercices 1.13</a></li>
<li class="chapter" data-level="2.1.14" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.14"><i class="fa fa-check"></i><b>2.1.14</b> Exercices 1.14</a></li>
<li class="chapter" data-level="2.1.15" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.15"><i class="fa fa-check"></i><b>2.1.15</b> Exercices 1.15</a></li>
<li class="chapter" data-level="2.1.16" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.16"><i class="fa fa-check"></i><b>2.1.16</b> Exercices 1.16</a></li>
<li class="chapter" data-level="2.1.17" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.17"><i class="fa fa-check"></i><b>2.1.17</b> Exercices 1.17</a></li>
<li class="chapter" data-level="2.1.18" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.18"><i class="fa fa-check"></i><b>2.1.18</b> Exercices 1.18</a></li>
<li class="chapter" data-level="2.1.19" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.19"><i class="fa fa-check"></i><b>2.1.19</b> Exercices 1.19</a></li>
<li class="chapter" data-level="2.1.20" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.20"><i class="fa fa-check"></i><b>2.1.20</b> Exercices 1.20</a></li>
<li class="chapter" data-level="2.1.21" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.21"><i class="fa fa-check"></i><b>2.1.21</b> Exercices 1.21</a></li>
<li class="chapter" data-level="2.1.22" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.22"><i class="fa fa-check"></i><b>2.1.22</b> Exercices 1.22</a></li>
<li class="chapter" data-level="2.1.23" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.23"><i class="fa fa-check"></i><b>2.1.23</b> Exercices 1.23</a></li>
<li class="chapter" data-level="2.1.24" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.24"><i class="fa fa-check"></i><b>2.1.24</b> Exercices 1.24</a></li>
<li class="chapter" data-level="2.1.25" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.25"><i class="fa fa-check"></i><b>2.1.25</b> Exercices 1.25</a></li>
<li class="chapter" data-level="2.1.26" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.26"><i class="fa fa-check"></i><b>2.1.26</b> Exercices 1.26</a></li>
<li class="chapter" data-level="2.1.27" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.27"><i class="fa fa-check"></i><b>2.1.27</b> Exercices 1.27</a></li>
<li class="chapter" data-level="2.1.28" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.28"><i class="fa fa-check"></i><b>2.1.28</b> Exercices 1.28</a></li>
<li class="chapter" data-level="2.1.29" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.29"><i class="fa fa-check"></i><b>2.1.29</b> Exercices 1.29</a></li>
<li class="chapter" data-level="2.1.30" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.30"><i class="fa fa-check"></i><b>2.1.30</b> Exercices 1.30</a></li>
<li class="chapter" data-level="2.1.31" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.31"><i class="fa fa-check"></i><b>2.1.31</b> Exercices 1.31</a></li>
<li class="chapter" data-level="2.1.32" data-path="characteristics-of-time-series.html"><a href="characteristics-of-time-series.html#exercices-1.32"><i class="fa fa-check"></i><b>2.1.32</b> Exercices 1.32</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html"><i class="fa fa-check"></i><b>3</b> Time Series Regression and Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercises"><i class="fa fa-check"></i><b>3.1</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.1"><i class="fa fa-check"></i><b>3.1.1</b> Exercise 2.1</a></li>
<li class="chapter" data-level="3.1.2" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.2"><i class="fa fa-check"></i><b>3.1.2</b> Exercise 2.2</a></li>
<li class="chapter" data-level="3.1.3" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.3"><i class="fa fa-check"></i><b>3.1.3</b> Exercise 2.3</a></li>
<li class="chapter" data-level="3.1.4" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.4"><i class="fa fa-check"></i><b>3.1.4</b> Exercise 2.4</a></li>
<li class="chapter" data-level="3.1.5" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.5"><i class="fa fa-check"></i><b>3.1.5</b> Exercise 2.5</a></li>
<li class="chapter" data-level="3.1.6" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.6"><i class="fa fa-check"></i><b>3.1.6</b> Exercise 2.6</a></li>
<li class="chapter" data-level="3.1.7" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.7"><i class="fa fa-check"></i><b>3.1.7</b> Exercise 2.7</a></li>
<li class="chapter" data-level="3.1.8" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.8"><i class="fa fa-check"></i><b>3.1.8</b> Exercise 2.8</a></li>
<li class="chapter" data-level="3.1.9" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.9"><i class="fa fa-check"></i><b>3.1.9</b> Exercise 2.9</a></li>
<li class="chapter" data-level="3.1.10" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.10"><i class="fa fa-check"></i><b>3.1.10</b> Exercise 2.10</a></li>
<li class="chapter" data-level="3.1.11" data-path="time-series-regression-and-exploratory-data-analysis.html"><a href="time-series-regression-and-exploratory-data-analysis.html#exercise-2.11"><i class="fa fa-check"></i><b>3.1.11</b> Exercise 2.11</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>4</b> Methods</a></li>
<li class="chapter" data-level="5" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>5</b> Applications</a>
<ul>
<li class="chapter" data-level="5.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series Analysis and Its Applications</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series-regression-and-exploratory-data-analysis" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Time Series Regression and Exploratory Data Analysis</h1>
<div id="exercises" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Exercises</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb36-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb36-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> DataFrames</span>
<span id="cb36-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Distributions</span>
<span id="cb36-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> GLM</span>
<span id="cb36-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> LinearAlgebra</span>
<span id="cb36-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Loess</span>
<span id="cb36-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MLLabelUtils</span>
<span id="cb36-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> PyPlot</span>
<span id="cb36-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> RData</span>
<span id="cb36-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> StatsBase</span>
<span id="cb36-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Statistics</span>
<span id="cb36-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> TimeSeries</span>
<span id="cb36-13"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="time-series-regression-and-exploratory-data-analysis.html#cb36-14" aria-hidden="true" tabindex="-1"></a>matplotlib.rcParams[<span class="st">&quot;text.usetex&quot;</span>] <span class="op">=</span> <span class="ex">true</span><span class="op">;</span></span></code></pre></div>
<div id="exercise-2.1" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Exercise 2.1</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb37-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb37-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb37-2" aria-hidden="true" tabindex="-1"></a>JJ <span class="op">=</span> load(<span class="st">&quot;../data/JJ.rda&quot;</span>)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb38-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb38-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb38-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb38-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb38-3" aria-hidden="true" tabindex="-1"></a>plot(JJ[<span class="st">&quot;jj&quot;</span>])</span>
<span id="cb38-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb38-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Time&quot;</span>)</span>
<span id="cb38-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb38-5" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Quarterly Earnings per Share&quot;</span>)</span>
<span id="cb38-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb38-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Johnson &amp; Johnson quarterly earnings per share, 84 quarters, 1690-I to 1980-IV&quot;</span>)</span>
<span id="cb38-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb38-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_4_0.png" /></p>
<ul>
<li><em>Question (a)</em></li>
</ul>
<p>Let’s fit the regression model
<span class="math display">\[x_t = \beta t + \alpha_1Q_1(t) + \alpha_2Q_2(t) + \alpha_3Q_3(t) + \alpha_4Q_4(t) + w_t,\]</span>
where <span class="math inline">\(Q_i(t) = 1\)</span> if time <span class="math inline">\(t\)</span> corresponds to quarter <span class="math inline">\(i = 1, 2, 3, 4\)</span> and zero otherwise.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb39-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data formatting</span></span>
<span id="cb39-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb39-2" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> <span class="op">-</span><span class="fl">10.00</span><span class="op">:</span><span class="fl">0.25</span><span class="op">:</span><span class="fl">10.75</span></span>
<span id="cb39-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb39-3" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> repeat([<span class="fl">1</span><span class="op">,</span> <span class="fl">2</span><span class="op">,</span> <span class="fl">3</span><span class="op">,</span> <span class="fl">4</span>]<span class="op">,</span> outer<span class="op">=</span>[<span class="fl">21</span>])</span>
<span id="cb39-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb39-4" aria-hidden="true" tabindex="-1"></a>Q_encoding <span class="op">=</span> DataFrame(transpose(convertlabel(LabelEnc.OneOfK<span class="op">,</span> Q)))</span>
<span id="cb39-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb39-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> hcat(DataFrame(Y<span class="op">=</span>[log(x) <span class="kw">for</span> x <span class="kw">in</span> JJ[<span class="st">&quot;jj&quot;</span>]]<span class="op">,</span> T<span class="op">=</span>time)<span class="op">,</span> Q_encoding)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb40-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model</span></span>
<span id="cb40-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb40-2" aria-hidden="true" tabindex="-1"></a>lm_model <span class="op">=</span> lm(<span class="pp">@formula</span>(Y <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> T <span class="op">+</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3 <span class="op">+</span> x4)<span class="op">,</span> data)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb41-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb41-1" aria-hidden="true" tabindex="-1"></a>lm_model</span></code></pre></div>
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Array{Float64,1}},GLM.DensePredChol{Float64,Cholesky{Float64,Array{Float64,2}}}},Array{Float64,2}}

Y ~ 0 + T + x1 + x2 + x3 + x4

Coefficients:
───────────────────────────────────────────────────────────────
       Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────
T   0.167172  0.00225911  74.00    &lt;1e-74   0.162676   0.171669
x1  1.05279   0.0273592   38.48    &lt;1e-52   0.998336   1.10725
x2  1.08092   0.027365    39.50    &lt;1e-53   1.02645    1.13538
x3  1.15102   0.0273825   42.03    &lt;1e-55   1.09652    1.20553
x4  0.882266  0.0274116   32.19    &lt;1e-46   0.827705   0.936828
───────────────────────────────────────────────────────────────</code></pre>
<ul>
<li>Question (b)</li>
</ul>
<p>Assuming the model is correct, the estimated average quarters increase in the logged earnings per share is <span class="math inline">\(0.17\)</span>. Thus, the estimated average annual increase is <span class="math inline">\(0.67\)</span>.</p>
<ul>
<li>Question (c)</li>
</ul>
<p>Assuming the model is correct, the average logged earnings rate increase from year to year in both the third and fourth quarters. It means that for two consecutive years, the earnings rate in the third quarter of the second year will be higher than in the first year and similarly for the fourth quarter. However, for a given year, the average logged earnings rate decrease from the third to the fourth quarter. In average, during the third quarter the logged earnings rate increases by <span class="math inline">\(15\%\)</span>, while it decreases by <span class="math inline">\(18\%\)</span> during the fourth quarter. (Not sure on this)</p>
<ul>
<li>Question (d)</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb43-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model with intercept</span></span>
<span id="cb43-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb43-2" aria-hidden="true" tabindex="-1"></a>lm_model_with_int <span class="op">=</span> lm(<span class="pp">@formula</span>(Y <span class="op">~</span> T <span class="op">+</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3 <span class="op">+</span> x4)<span class="op">,</span> data)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb44-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb44-1" aria-hidden="true" tabindex="-1"></a>lm_model_with_int</span></code></pre></div>
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Array{Float64,1}},GLM.DensePredChol{Float64,Cholesky{Float64,Array{Float64,2}}}},Array{Float64,2}}

Y ~ 1 + T + x1 + x2 + x3 + x4

Coefficients:
─────────────────────────────────────────────────────────────────────────
                Coef.  Std. Error      t  Pr(&gt;|t|)   Lower 95%  Upper 95%
─────────────────────────────────────────────────────────────────────────
(Intercept)  0.444766  1.49687e6    0.00    1.0000  -2.98004e6  2.98004e6
T            0.167172  0.00227355  73.53    &lt;1e-73   0.162646   0.171698
x1           0.608027  1.49687e6    0.00    1.0000  -2.98004e6  2.98004e6
x2           0.636149  1.49687e6    0.00    1.0000  -2.98004e6  2.98004e6
x3           0.706258  1.49687e6    0.00    1.0000  -2.98004e6  2.98004e6
x4           0.4375    1.49687e6    0.00    1.0000  -2.98004e6  2.98004e6
─────────────────────────────────────────────────────────────────────────</code></pre>
<p>When an intercept is include is the model, the quarters variables are not significant anymore (but the trend coefficient is the same). The intercept hides the periodic effect express by the quarters. Without the intercept, one fit one linear model for each quarter.</p>
<ul>
<li>Question (e)</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb46-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb46-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb46-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-3" aria-hidden="true" tabindex="-1"></a>plot(JJ[<span class="st">&quot;jj&quot;</span>]<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Observation&quot;</span>)</span>
<span id="cb46-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-4" aria-hidden="true" tabindex="-1"></a>plot([exp(x) <span class="kw">for</span> x <span class="kw">in</span> StatsBase.predict(lm_model)]<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Prediction&quot;</span>)</span>
<span id="cb46-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-5" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Time&quot;</span>)</span>
<span id="cb46-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Quarterly Earnings per Share&quot;</span>)</span>
<span id="cb46-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-7" aria-hidden="true" tabindex="-1"></a>legend()</span>
<span id="cb46-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-8" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Johnson &amp; Johnson quarterly earnings per share, 84 quarters, 1690-I to 1980-IV&quot;</span>)</span>
<span id="cb46-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb46-9" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_16_0.png" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb47-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb47-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb47-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb47-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb47-3" aria-hidden="true" tabindex="-1"></a>scatter(<span class="fl">1</span><span class="op">:</span><span class="fl">84</span><span class="op">,</span> data[<span class="op">!,</span> <span class="st">&quot;Y&quot;</span>] <span class="op">-</span> StatsBase.predict(lm_model))</span>
<span id="cb47-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb47-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Time&quot;</span>)</span>
<span id="cb47-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb47-5" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb47-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb47-6" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_17_0.png" /></p>
<p>The model fits quite well the data. The residuals do not look exactly white, we still see some pattern in the previous graph. However, the approximation is correct.</p>
</div>
<div id="exercise-2.2" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Exercise 2.2</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb48-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb48-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb48-2" aria-hidden="true" tabindex="-1"></a>mort <span class="op">=</span> load(<span class="st">&quot;../data/cmort.rda&quot;</span>)[<span class="st">&quot;cmort&quot;</span>]<span class="op">;</span></span>
<span id="cb48-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb48-3" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> load(<span class="st">&quot;../data/tempr.rda&quot;</span>)[<span class="st">&quot;tempr&quot;</span>]<span class="op">;</span></span>
<span id="cb48-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb48-4" aria-hidden="true" tabindex="-1"></a>part <span class="op">=</span> load(<span class="st">&quot;../data/part.rda&quot;</span>)[<span class="st">&quot;part&quot;</span>]<span class="op">;</span></span></code></pre></div>
<ul>
<li>Question (a)</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb49-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the model matrix</span></span>
<span id="cb49-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb49-2" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> <span class="dt">LinRange</span>(<span class="fl">1970.0</span><span class="op">,</span> <span class="fl">1979.7692308</span><span class="op">,</span> <span class="fl">508</span>)[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">;</span></span>
<span id="cb49-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb49-3" aria-hidden="true" tabindex="-1"></a>temp1 <span class="op">=</span> [i <span class="op">-</span> mean(temp) <span class="kw">for</span> i <span class="kw">in</span> temp][<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">;</span></span>
<span id="cb49-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb49-4" aria-hidden="true" tabindex="-1"></a>temp2 <span class="op">=</span> [(i <span class="op">-</span> mean(temp))<span class="op">^</span><span class="fl">2</span> <span class="kw">for</span> i <span class="kw">in</span> temp][<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">;</span></span>
<span id="cb49-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb49-5" aria-hidden="true" tabindex="-1"></a>part1 <span class="op">=</span> part[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">;</span></span>
<span id="cb49-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb49-6" aria-hidden="true" tabindex="-1"></a>part4 <span class="op">=</span> part[<span class="fl">1</span><span class="op">:</span>(<span class="kw">end</span> <span class="op">-</span> <span class="fl">4</span>)]<span class="op">;</span></span>
<span id="cb49-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb49-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> DataFrame(M<span class="op">=</span>mort[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> T<span class="op">=</span>time<span class="op">,</span> temp1<span class="op">=</span>temp1<span class="op">,</span> temp2<span class="op">=</span>temp2<span class="op">,</span> part1<span class="op">=</span>part1<span class="op">,</span> part4<span class="op">=</span>part4)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb50-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model with intercept</span></span>
<span id="cb50-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb50-2" aria-hidden="true" tabindex="-1"></a>lm_model <span class="op">=</span> lm(<span class="pp">@formula</span>(M <span class="op">~</span> T <span class="op">+</span> temp1 <span class="op">+</span> temp2 <span class="op">+</span> part1 <span class="op">+</span> part4)<span class="op">,</span> data)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb51-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb51-1" aria-hidden="true" tabindex="-1"></a>lm_model</span></code></pre></div>
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Array{Float64,1}},GLM.DensePredChol{Float64,LinearAlgebra.Cholesky{Float64,Array{Float64,2}}}},Array{Float64,2}}

M ~ 1 + T + temp1 + temp2 + part1 + part4

Coefficients:
─────────────────────────────────────────────────────────────────────────────────────
                    Coef.    Std. Error       t  Pr(&gt;|t|)     Lower 95%     Upper 95%
─────────────────────────────────────────────────────────────────────────────────────
(Intercept)  2802.96       198.462        14.12    &lt;1e-37  2413.03       3192.88
T              -1.38261      0.100445    -13.76    &lt;1e-36    -1.57996      -1.18526
temp1          -0.405808     0.0352788   -11.50    &lt;1e-26    -0.475121     -0.336494
temp2           0.0215466    0.00280251    7.69    &lt;1e-13     0.0160404     0.0270528
part1           0.202882     0.0226577     8.95    &lt;1e-17     0.158366      0.247399
part4           0.103037     0.0248461     4.15    &lt;1e-4      0.0542209     0.151853
─────────────────────────────────────────────────────────────────────────────────────</code></pre>
<p>The results appear to be quite good. All the coefficients are significant.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb53-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb53-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb53-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-3" aria-hidden="true" tabindex="-1"></a>plot(mort[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Observation&quot;</span>)</span>
<span id="cb53-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-4" aria-hidden="true" tabindex="-1"></a>plot(StatsBase.predict(lm_model)<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Prediction&quot;</span>)</span>
<span id="cb53-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-5" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Time&quot;</span>)</span>
<span id="cb53-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Mortality&quot;</span>)</span>
<span id="cb53-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-7" aria-hidden="true" tabindex="-1"></a>legend()</span>
<span id="cb53-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-8" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Cardiovascular Mortality&quot;</span>)</span>
<span id="cb53-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb53-9" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_26_0.png" /></p>
<ul>
<li>Question (b)</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb54-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb54-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">131</span>)</span>
<span id="cb54-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> scatter(mort[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> temp1)</span>
<span id="cb54-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Mortality&quot;</span>)</span>
<span id="cb54-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-5" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Temperature&quot;</span>)</span>
<span id="cb54-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-7" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">132</span>)</span>
<span id="cb54-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> scatter(mort[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> part1)</span>
<span id="cb54-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-9" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Mortality&quot;</span>)</span>
<span id="cb54-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-10" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Particulates&quot;</span>)</span>
<span id="cb54-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-12" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">133</span>)</span>
<span id="cb54-13"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-13" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> scatter(mort[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> part4)</span>
<span id="cb54-14"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-14" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Mortality&quot;</span>)</span>
<span id="cb54-15"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-15" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Particulates four weeks prior&quot;</span>)</span>
<span id="cb54-16"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="time-series-regression-and-exploratory-data-analysis.html#cb54-17" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_28_0.png" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb55-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between M_t and P_t</span></span>
<span id="cb55-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb55-2" aria-hidden="true" tabindex="-1"></a>cor(mort[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> part1)</span></code></pre></div>
<pre><code>0.44228958011390346</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb57-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between M_t and P_{t-4}</span></span>
<span id="cb57-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb57-2" aria-hidden="true" tabindex="-1"></a>cor(mort[<span class="fl">5</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> part4)</span></code></pre></div>
<pre><code>0.5209993034593486</code></pre>
<p><span class="math inline">\(M_t\)</span> and <span class="math inline">\(P_{t-4}\)</span> have a higher correlation than <span class="math inline">\(M_t\)</span> and <span class="math inline">\(P_t\)</span>. So, using <span class="math inline">\(P_{t-4}\)</span> instead of <span class="math inline">\(P_t\)</span> in the linear model should results to better fit.</p>
</div>
<div id="exercise-2.3" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Exercise 2.3</h3>
<ul>
<li>Question (a) - Random walk</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb59-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> figure(figsize<span class="op">=</span>(<span class="fl">20</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb59-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span id="cb59-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-3" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> cumsum(rand(Normal(<span class="fl">0.01</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">,</span> <span class="fl">100</span>))</span>
<span id="cb59-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-4" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb59-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> DataFrame(X<span class="op">=</span>X<span class="op">,</span> T<span class="op">=</span>T)</span>
<span id="cb59-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-6" aria-hidden="true" tabindex="-1"></a>    lm_model <span class="op">=</span> lm(<span class="pp">@formula</span>(X <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> T)<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb59-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-8" aria-hidden="true" tabindex="-1"></a>    subplot(<span class="fl">1</span><span class="op">,</span> <span class="fl">4</span><span class="op">,</span> i)</span>
<span id="cb59-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-9" aria-hidden="true" tabindex="-1"></a>    plot(X<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Observation&quot;</span>)</span>
<span id="cb59-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-10" aria-hidden="true" tabindex="-1"></a>    plot([<span class="fl">0.1</span><span class="op">*</span>t <span class="kw">for</span> t <span class="kw">in</span> T]<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;True&quot;</span>)</span>
<span id="cb59-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-11" aria-hidden="true" tabindex="-1"></a>    plot(StatsBase.predict(lm_model)<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Prediction&quot;</span>)</span>
<span id="cb59-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-12" aria-hidden="true" tabindex="-1"></a>    xlabel(L<span class="st">&quot;$t$&quot;</span>)</span>
<span id="cb59-13"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-13" aria-hidden="true" tabindex="-1"></a>    ylabel(L<span class="st">&quot;$x_t$&quot;</span>)</span>
<span id="cb59-14"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-14" aria-hidden="true" tabindex="-1"></a>    legend()</span>
<span id="cb59-15"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb59-16"><a href="time-series-regression-and-exploratory-data-analysis.html#cb59-16" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_34_0.png" /></p>
<ul>
<li>Question (b) - Linear trend plus noise</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb60-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> figure(figsize<span class="op">=</span>(<span class="fl">20</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb60-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span id="cb60-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-3" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb60-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-4" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> T <span class="op">+</span> rand(Normal()<span class="op">,</span> <span class="fl">100</span>)</span>
<span id="cb60-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> DataFrame(X<span class="op">=</span>X<span class="op">,</span> T<span class="op">=</span>T)</span>
<span id="cb60-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-6" aria-hidden="true" tabindex="-1"></a>    lm_model <span class="op">=</span> lm(<span class="pp">@formula</span>(X <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> T)<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb60-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-8" aria-hidden="true" tabindex="-1"></a>    subplot(<span class="fl">1</span><span class="op">,</span> <span class="fl">4</span><span class="op">,</span> i)</span>
<span id="cb60-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-9" aria-hidden="true" tabindex="-1"></a>    plot(X<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Observation&quot;</span>)</span>
<span id="cb60-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-10" aria-hidden="true" tabindex="-1"></a>    plot([<span class="fl">0.1</span><span class="op">*</span>t <span class="kw">for</span> t <span class="kw">in</span> T]<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;True&quot;</span>)</span>
<span id="cb60-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-11" aria-hidden="true" tabindex="-1"></a>    plot(StatsBase.predict(lm_model)<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Prediction&quot;</span>)</span>
<span id="cb60-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-12" aria-hidden="true" tabindex="-1"></a>    xlabel(L<span class="st">&quot;$t$&quot;</span>)</span>
<span id="cb60-13"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-13" aria-hidden="true" tabindex="-1"></a>    ylabel(L<span class="st">&quot;$x_t$&quot;</span>)</span>
<span id="cb60-14"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-14" aria-hidden="true" tabindex="-1"></a>    legend()</span>
<span id="cb60-15"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb60-16"><a href="time-series-regression-and-exploratory-data-analysis.html#cb60-16" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_36_0.png" /></p>
<ul>
<li>Question (c)</li>
</ul>
<p>The assignement shows that we should be very careful in case of correlated errors (see random walks). The estimated mean function is thus bad estimated, and without multiple realizations of the process (functional data), the mean is hardly estimated. For non-correlated errors (linear trend), all is well, and the predicted mean curve lies close to the true one. Linear models assume non-correlated errors.</p>
</div>
<div id="exercise-2.4" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Exercise 2.4</h3>
<p>Let <span class="math inline">\(y = (y_1, \dots, y_n)\)</span>, <span class="math inline">\(Z \in \mathbb{R}^{n \times k}\)</span> and <span class="math inline">\(\beta = \mathbb{R}^k\)</span>.
Consider the Gaussian regression model:
<span class="math display">\[y = Z\beta + w, \quad\text{where}~ w \sim \mathcal{N}(0, \sigma^2\mathbb{1}_n).\]</span></p>
<p>Thus, we have <span class="math inline">\(y \sim \mathcal{N}(Z\beta, \sigma^2\mathbb{1}_n)\)</span> and so, <span class="math inline">\(f(y; \beta, \sigma^2\mathbb{1}_n) = (2\pi)^{-n/2}\text{det}(\sigma^2\mathbb{1}_n)^{-1/2}\exp\left(-\frac{1}{2}(y - Z\beta)^\top \sigma^{-2}\mathbb{1}_n(y - Z\beta)\right)\)</span>.</p>
<p>The Kullback-Leibler Information for discriminating between two densities in the same family is given by:</p>
<p><span class="math display">\[\begin{align}
I(\beta_1, \sigma_1; \beta_2, \sigma_2) &amp;= \frac{1}{n}\mathbb{E}_1\left(\log(f(y; \beta_1, \sigma_1) - \log(f(y; \beta_2, \sigma_2)\right) \\
&amp;= \frac{1}{2n}\mathbb{E}_1\left(- \log\text{det}(\sigma_1^2\mathbb{1}_n) - (y - Z\beta_1)^\top\sigma_1^{-2}\mathbb{1}_n(y - Z\beta_1) + \log\text{det}(\sigma_2^2\mathbb{1}_n) + (y - Z\beta_2)^\top\sigma_2^{-2}\mathbb{1}_n(y - Z\beta_2)\right) \\
&amp;= \frac{1}{2n}\log\left(\frac{\text{det}(\sigma_2^2\mathbb{1}_n)}{\text{det}(\sigma_1^2\mathbb{1}_n)}\right) + \frac{1}{2n}\mathbb{E}_1\left((y - Z\beta_2)^\top\sigma_2^{-2}\mathbb{1}_n(y - Z\beta_2) - (y - Z\beta_1)^\top\sigma_1^{-2}\mathbb{1}_n(y - Z\beta_1)\right) \\
&amp;= \frac{1}{2}\log\left(\frac{\sigma_2^2}{\sigma_1^2}\right) + \frac{1}{2n}\mathbb{E}_1\left(\text{tr}(\sigma_2^{-2}(y - Z\beta_2)(y - Z\beta_2)^\top) - \text{tr}(\sigma_1^{-2}(y - Z\beta_1)(y - Z\beta_1)^\top)\right) \\
&amp;= \frac{1}{2}\log\left(\frac{\sigma_2^2}{\sigma_1^2}\right) + \frac{1}{2n}\mathbb{E}_1\left(\text{tr}(\sigma_2^{-2}(y - Z\beta_2)(y - Z\beta_2)^\top)\right) - \frac{1}{2n}\text{tr}(\sigma_1^{-2}\left(\mathbb{E}_1(y - Z\beta_1)(y - Z\beta_1)^\top)\right) \\
&amp;= \frac{1}{2}\log\left(\frac{\sigma_2^2}{\sigma_1^2}\right) + \frac{1}{2n}\mathbb{E}_1\left(\text{tr}(\sigma_2^{-2}(y - Z\beta_2)(y - Z\beta_2)^\top)\right) - \frac{1}{2n}\text{tr}(\sigma_1^{-2}\sigma_1^2\mathbb{1}_n) \\
&amp;= \frac{1}{2}\log\left(\frac{\sigma_2^2}{\sigma_1^2}\right) - \frac{1}{2} + \frac{\sigma_2^{-2}}{2n}\mathbb{E}_1\left(\text{tr}(yy^\top - 2y\beta_2^\top Z^\top + \beta_2^\top Z^\top Z\beta_2)\right) \\
&amp;= \frac{1}{2}\log\left(\frac{\sigma_2^2}{\sigma_1^2}\right) - \frac{1}{2} + \frac{\sigma_2^{-2}}{2n}\left(\text{tr}(\sigma_1^{2}\mathbb{1}_n + \beta_1^\top Z^\top Z\beta_1 - 2Z\beta_1\beta_2^\top Z^\top + \beta_2^\top Z^\top Z\beta_2)\right) \\
&amp;= \frac{1}{2}\log\left(\frac{\sigma_2^2}{\sigma_1^2}\right) - \frac{1}{2} + \frac{\sigma_1^{2}}{2\sigma_2^2} + \frac{1}{2}\frac{(\beta_1 - \beta_2)^\top Z^\top Z (\beta_1 - \beta_2)}{n\sigma_2^2} \\
&amp;= \frac{1}{2}\left(\log\left(\frac{\sigma_2^2}{\sigma_1^2}\right) - 1 + \frac{\sigma_1^{2}}{\sigma_2^2} + \frac{(\beta_1 - \beta_2)^\top Z^\top Z (\beta_1 - \beta_2)}{n\sigma_2^2}\right)
\end{align}\]</span></p>
</div>
<div id="exercise-2.5" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Exercise 2.5</h3>
<p>Consider to find an unbiased estimator for <span class="math inline">\(\mathbb{E}_1(I(\beta_1, \sigma_1^2; \widehat{\beta}, \widehat{\sigma}^2)).\)</span></p>
<p><span class="math display">\[\begin{align}
\mathbb{E}_1(I(\beta_1, \sigma_1^2; \widehat{\beta}, \widehat{\sigma}^2)) &amp;= \frac{1}{2}\left(\mathbb{E}_1\left(\frac{\sigma_1^2}{\widehat{\sigma}^2}\right) - \mathbb{E}_1\log\left(\frac{\sigma_1^2}{\widehat{\sigma}^2}\right) - 1 + \mathbb{E}_1\left(\frac{(\beta_1 - \widehat\beta)^\top Z\top Z (\beta_1 - \widehat\beta)}{n\widehat{\sigma}^2}\right)\right) \\
&amp;= \frac{1}{2}\left(n\mathbb{E}_1\left(\frac{\sigma_1^2}{n\widehat{\sigma}^2}\right) - \log(\sigma_1^2) + \mathbb{E}_1(\log(\widehat\sigma^2)) - 1 + \mathbb{E}_1\left(\frac{\sigma_1^2}{\sigma_1^2}\frac{(\beta_1 - \widehat\beta)^\top Z\top Z (\beta_1 - \widehat\beta)}{n\widehat{\sigma}^2}\right)\right) \\
&amp;= \frac{1}{2}\left(\frac{n}{n - k - 2} - \log(\sigma_1^2) + \mathbb{E}_1(\log(\widehat\sigma^2)) - 1 + \mathbb{E}_1\left(\frac{\sigma_1^2}{n\widehat\sigma^2}\right)\mathbb{E}_1\left(\frac{(\beta_1 - \widehat\beta)^\top Z\top Z (\beta_1 - \widehat\beta)}{\sigma_1^2}\right)\right) \\
&amp;= \frac{1}{2}\left(- \log(\sigma_1^2) + \mathbb{E}_1(\log(\widehat\sigma^2)) + \frac{n - k}{n - k - 2} - 1\right) \\
\end{align}\]</span></p>
</div>
<div id="exercise-2.6" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Exercise 2.6</h3>
<p>Consider a process consisting of a linear trend with an additive noise term consisting of independent random variables <span class="math inline">\(w_t\)</span> with zero means and variances <span class="math inline">\(\sigma_w^2\)</span>, that is
<span class="math display">\[x_t = \beta_0 + \beta_1t + w_t,\]</span>
where <span class="math inline">\(\beta_0, \beta_1\)</span> are fixed constants.</p>
<ul>
<li><em>Question (a)</em></li>
</ul>
<p>The process <span class="math inline">\(x_t\)</span> is nonstationary because its mean value function is <span class="math inline">\(\mu_t = \beta_0 + \beta_1 t\)</span> and thus depend on <span class="math inline">\(t\)</span>.</p>
<ul>
<li><em>Question (b)</em></li>
</ul>
<p>Consider the first difference series <span class="math inline">\(\nabla x_t = x_t - x_{t - 1}\)</span>. Clearly, its mean value function does not depend on time <span class="math inline">\(t\)</span> (equal to <span class="math inline">\(\beta_1\)</span>).
The autocovariance is:
<span class="math display">\[\begin{align}
\gamma(s, t) &amp;= Cov(\nabla x_s, \nabla x_t) \\
             &amp;= Cov(\beta_1 + w_s - w_{s-1}, \beta_1 + w_t - w_{t-1}) \\
             &amp;= Cov(w_s, w_t) - Cov(w_s, w_{t-1}) - Cov(w_{s-1}, w_t) + Cov(w_{s-1}, w_{t-1}) \\
             &amp;= \left\{
                    \begin{array}{r c l}
                        2\sigma_w^2 &amp;if&amp; s - t = 0\\
                        -\sigma_w^2 &amp;if&amp; \vert s - t \vert = 1\\
                    \end{array}
               \right.,
\end{align}\]</span>
and thus depends on <span class="math inline">\(s\)</span> and <span class="math inline">\(t\)</span> only through their difference <span class="math inline">\(\lvert s - t \rvert\)</span>. And, so the process is stationary.</p>
<ul>
<li><em>Question (c)</em></li>
</ul>
<p>We replace <span class="math inline">\(w_t\)</span> by a general stationary process <span class="math inline">\(y_t\)</span>, with mean <span class="math inline">\(\mu_y\)</span> and autocovariance function <span class="math inline">\(\gamma_y(h)\)</span>. Clearly, the mean value of the process <span class="math inline">\(\nabla x_t\)</span> is still <span class="math inline">\(\beta_1\)</span> and does not depend on time <span class="math inline">\(t\)</span>. The autocovariance is <span class="math inline">\(\gamma(h) = 2\gamma_y(h) - \gamma_y(h + 1) - \gamma_y(h - 1)\)</span>. It depends only on <span class="math inline">\(h\)</span>, so this process is also stationary.</p>
</div>
<div id="exercise-2.7" class="section level3" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> Exercise 2.7</h3>
<p>We consider the process <span class="math inline">\(\nabla x_t = \delta + w_t + y_t - y_{t-1}\)</span> where <span class="math inline">\(w_t \sim \mathcal{N}(0, \sigma^2)\)</span>. Noting that <span class="math inline">\((w_t)_t\)</span> and <span class="math inline">\((y_t - y_{t-1})_t\)</span> are independant, and using the previous exercise, <span class="math inline">\(\nabla x_t\)</span> is a stationary process.</p>
</div>
<div id="exercise-2.8" class="section level3" number="3.1.8">
<h3><span class="header-section-number">3.1.8</span> Exercise 2.8</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb61-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb61-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb61-2" aria-hidden="true" tabindex="-1"></a>varve <span class="op">=</span> load(<span class="st">&quot;../data/varve.rda&quot;</span>)[<span class="st">&quot;varve&quot;</span>]<span class="op">;</span></span>
<span id="cb61-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb61-3" aria-hidden="true" tabindex="-1"></a>log_varve <span class="op">=</span> [log(x) <span class="kw">for</span> x <span class="kw">in</span> varve]<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb62-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb62-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb62-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb62-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb62-3" aria-hidden="true" tabindex="-1"></a>plot(varve)</span>
<span id="cb62-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb62-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Years&quot;</span>)</span>
<span id="cb62-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb62-5" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Thicknesses&quot;</span>)</span>
<span id="cb62-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb62-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Glacial varve thicknesses from Massachusetts&quot;</span>)</span>
<span id="cb62-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb62-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_44_0.png" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb63-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the log data</span></span>
<span id="cb63-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb63-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb63-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb63-3" aria-hidden="true" tabindex="-1"></a>plot(log_varve)</span>
<span id="cb63-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb63-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Years&quot;</span>)</span>
<span id="cb63-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb63-5" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;log-Thicknesses&quot;</span>)</span>
<span id="cb63-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb63-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Glacial varve log-thicknesses from Massachusetts&quot;</span>)</span>
<span id="cb63-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb63-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_45_0.png" /></p>
<ul>
<li><em>Question (a)</em></li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb64-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb64-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">121</span>)</span>
<span id="cb64-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> hist(varve<span class="op">,</span> density<span class="op">=</span><span class="ex">true</span>)</span>
<span id="cb64-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Thickness&quot;</span>)</span>
<span id="cb64-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-5" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Density&quot;</span>)</span>
<span id="cb64-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Variance: 1st half - $(var(varve[1:317]))</span></span>
<span id="cb64-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fl">2</span>nd half <span class="op">-</span> <span class="op">$</span>(var(varve[<span class="fl">318</span><span class="op">:</span><span class="fl">634</span>]))<span class="st">&quot;)</span></span>
<span id="cb64-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-9" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">122</span>)</span>
<span id="cb64-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> hist(log_varve<span class="op">,</span> density<span class="op">=</span><span class="ex">true</span>)</span>
<span id="cb64-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-11" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;log-Thickness&quot;</span>)</span>
<span id="cb64-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-12" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Density&quot;</span>)</span>
<span id="cb64-13"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-13" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Variance: 1st half - $(var(log_varve[1:317]))</span></span>
<span id="cb64-14"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-14" aria-hidden="true" tabindex="-1"></a>                 <span class="fl">2</span>nd half <span class="op">-</span> <span class="op">$</span>(var(log_varve[<span class="fl">318</span><span class="op">:</span><span class="fl">634</span>]))<span class="st">&quot;)</span></span>
<span id="cb64-15"><a href="time-series-regression-and-exploratory-data-analysis.html#cb64-15" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_47_0.png" /></p>
<p>We see that the serie exhibits heteroscedasticity thanks to the computation of the variance. The log-transformation stabilized a bit the variance within the data. Morover, the normality assumption is more reflected in the log-data.</p>
<ul>
<li><em>Question (b)</em></li>
</ul>
<p>Regarding the plot of the series <span class="math inline">\(y_t\)</span>, it seems that the series decrease for the first <span class="math inline">\(200\)</span> years, then increase for <span class="math inline">\(250\)</span> years, and finally decrease until the end.</p>
<ul>
<li><em>Question (c)</em></li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb65-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ACF</span></span>
<span id="cb65-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb65-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb65-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb65-3" aria-hidden="true" tabindex="-1"></a>stem(<span class="fl">0</span><span class="op">:</span><span class="fl">633</span><span class="op">,</span> autocor(log_varve<span class="op">,</span> <span class="fl">0</span><span class="op">:</span><span class="fl">633</span>)<span class="op">,</span> use_line_collection<span class="op">=</span><span class="ex">true</span>)</span>
<span id="cb65-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb65-4" aria-hidden="true" tabindex="-1"></a>hlines([<span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">634</span>)<span class="op">,</span> <span class="op">-</span><span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">634</span>)]<span class="op">,</span> xmin<span class="op">=</span><span class="fl">0</span><span class="op">,</span> xmax<span class="op">=</span><span class="fl">634</span><span class="op">,</span> colors<span class="op">=</span><span class="st">&quot;red&quot;</span><span class="op">,</span> linestyles<span class="op">=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb65-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb65-5" aria-hidden="true" tabindex="-1"></a>xlabel(L<span class="st">&quot;$h$&quot;</span>)</span>
<span id="cb65-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb65-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Autocorrelation function&quot;</span>)</span>
<span id="cb65-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb65-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_49_0.png" /></p>
<p>The autocorrelation is still quite important until <span class="math inline">\(h = 500\)</span>. Note that between <span class="math inline">\(h = 100\)</span> and <span class="math inline">\(h = 350\)</span>, <span class="math inline">\(y_t\)</span> and <span class="math inline">\(y_{t + h}\)</span> are negatively correlated. The autocorrelation does not really belong to the <span class="math inline">\(95\%\)</span> CI (red dashd lines), and there is clearly not an exponential decay of the ACF. So, the series is not stationary.</p>
<ul>
<li><em>Question (d)</em></li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb66-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb66-1" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> log_varve[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>] <span class="op">-</span> log_varve[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">1</span>]<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb67-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the log data</span></span>
<span id="cb67-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb67-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb67-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb67-3" aria-hidden="true" tabindex="-1"></a>plot(u)</span>
<span id="cb67-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb67-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Years&quot;</span>)</span>
<span id="cb67-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb67-5" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Glacial varve log-thicknesses first difference from Massachusetts&quot;</span>)</span>
<span id="cb67-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb67-6" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_52_0.png" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb68-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ACF</span></span>
<span id="cb68-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb68-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb68-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb68-3" aria-hidden="true" tabindex="-1"></a>stem(<span class="fl">0</span><span class="op">:</span><span class="fl">632</span><span class="op">,</span> autocor(u<span class="op">,</span> <span class="fl">0</span><span class="op">:</span><span class="fl">632</span>)<span class="op">,</span> use_line_collection<span class="op">=</span><span class="ex">true</span>)</span>
<span id="cb68-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb68-4" aria-hidden="true" tabindex="-1"></a>hlines([<span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">634</span>)<span class="op">,</span> <span class="op">-</span><span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">634</span>)]<span class="op">,</span> xmin<span class="op">=</span><span class="fl">0</span><span class="op">,</span> xmax<span class="op">=</span><span class="fl">634</span><span class="op">,</span> colors<span class="op">=</span><span class="st">&quot;red&quot;</span><span class="op">,</span> linestyles<span class="op">=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb68-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb68-5" aria-hidden="true" tabindex="-1"></a>xlabel(L<span class="st">&quot;$h$&quot;</span>)</span>
<span id="cb68-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb68-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Autocorrelation function&quot;</span>)</span>
<span id="cb68-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb68-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_53_0.png" /></p>
<p>The autocovariance function decrease rapidly the <span class="math inline">\(95\%\)</span> CI (red dashed lines). This series is a reasonably stationary series. It is an estimation of <span class="math inline">\(x_t - x_{t-1} / x_{t-1}\)</span> when this quantity is small. This can be usefull for the analysis of the return.</p>
<ul>
<li><em>Question (e)</em></li>
</ul>
<p>The series <span class="math inline">\(u_t\)</span> is assumed to be stationary. So, its mean function does not depend on time. Moreover, it has been build by differentiate two series. So, its seems reasonable to assume the following expansion for <span class="math inline">\(u_t\)</span>:
<span class="math display">\[u_t = \mu + w_t + \theta w_{t-1}.\]</span>
This is a direct generalisation of the example <span class="math inline">\(1.26\)</span> with <span class="math inline">\(w_t\)</span> a continuous random variable.
We assume that the <span class="math inline">\(w_t\)</span> are independent with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(\sigma_w^2\)</span>.</p>
<p><span class="math display">\[\begin{align}
\gamma(s, t) &amp;= Cov(u_s, u_t) \\
             &amp;= Cov(\mu + w_s + \theta w_{s-1}, \mu + w_t + \theta w_{t-1}) \\
             &amp;= Cov(w_s, w_t) +\theta Cov(w_s, w_{t-1})+\theta Cov(w_{s-1}, w_t)+\theta^2 Cov(w_{s-1}, w_{t-1}) \\
             &amp;= \left\{
                    \begin{array}{r c l}
                        (1 + \theta^2)\sigma_w^2 &amp;if&amp; s - t = 0\\
                        \theta \sigma_w^2 &amp;if&amp; \vert s - t \vert = 1\\
                        0 &amp;if&amp; \vert s - t \vert &gt; 1
                    \end{array}
               \right.
\end{align}\]</span></p>
<ul>
<li><em>Question (f)</em></li>
</ul>
<p>Considering <span class="math inline">\(\rho_u(1)\)</span> and <span class="math inline">\(\gamma_u(0)\)</span>, we found out that
<span class="math display">\[\theta^2 \rho_u(1) - \theta + \rho_u(1) = 0.\]</span>
Thus, resolving the second order polynmials, we have
<span class="math display">\[\theta = \frac{1 \pm \sqrt{1 - 4\rho_u(1)}}{2\rho_u(1)}.\]</span>
Finally, by replacing this expression within <span class="math inline">\(\gamma_u(0)\)</span>, we have an expression for <span class="math inline">\(\sigma_w^2\)</span>
<span class="math display">\[\sigma_w^2 = \left(1 + \frac{1 \pm \sqrt{1 - 4\rho_u(1)}}{2\rho_u^2(1)} - \frac{1}{\rho_u(1)}\right)^{-1}\gamma_u(0).\]</span></p>
</div>
<div id="exercise-2.9" class="section level3" number="3.1.9">
<h3><span class="header-section-number">3.1.9</span> Exercise 2.9</h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb69-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb69-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb69-2" aria-hidden="true" tabindex="-1"></a>SOI <span class="op">=</span> load(<span class="st">&quot;../data/soi.rda&quot;</span>)[<span class="st">&quot;soi&quot;</span>]<span class="op">;</span></span></code></pre></div>
<ul>
<li><em>Question (a)</em></li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb70-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the model matrix</span></span>
<span id="cb70-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb70-2" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> <span class="dt">LinRange</span>(<span class="fl">1</span><span class="op">,</span> <span class="fl">453</span><span class="op">,</span> <span class="fl">453</span>)<span class="op">;</span></span>
<span id="cb70-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb70-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> DataFrame(S<span class="op">=</span>SOI<span class="op">,</span> T<span class="op">=</span>time)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb71-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model</span></span>
<span id="cb71-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb71-2" aria-hidden="true" tabindex="-1"></a>lm_model <span class="op">=</span> lm(<span class="pp">@formula</span>(S <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> T)<span class="op">,</span> data)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb72-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb72-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb72-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-3" aria-hidden="true" tabindex="-1"></a>plot(SOI<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Observation&quot;</span>)</span>
<span id="cb72-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-4" aria-hidden="true" tabindex="-1"></a>plot(StatsBase.predict(lm_model)<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Trend&quot;</span>)</span>
<span id="cb72-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-5" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Time&quot;</span>)</span>
<span id="cb72-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;SOI&quot;</span>)</span>
<span id="cb72-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-7" aria-hidden="true" tabindex="-1"></a>legend()</span>
<span id="cb72-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-8" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Southern Oscillation Index&quot;</span>)</span>
<span id="cb72-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb72-9" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_60_0.png" /></p>
<p>It does not appear a significant trend in the sea surface temperature in the data.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb73-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb73-1" aria-hidden="true" tabindex="-1"></a>SOI_detrended <span class="op">=</span> SOI <span class="op">-</span> StatsBase.predict(lm_model)<span class="op">;</span></span></code></pre></div>
<ul>
<li><em>Question (b)</em></li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb74-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb74-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> periodogram(SOI_detrended<span class="op">,</span> fs<span class="op">=</span><span class="fl">1</span>)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb75-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb75-1" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb75-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb75-2" aria-hidden="true" tabindex="-1"></a>plot(p.freq<span class="op">,</span> p.power)</span>
<span id="cb75-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb75-3" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Frenquency&quot;</span>)</span>
<span id="cb75-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb75-4" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Periodogram&quot;</span>)</span>
<span id="cb75-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb75-5" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_65_0.png" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb76-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb76-1" aria-hidden="true" tabindex="-1"></a>big_perio <span class="op">=</span> sortperm(p.power<span class="op">,</span> rev<span class="op">=</span><span class="ex">true</span>)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb77-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Three most important frequency</span></span>
<span id="cb77-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb77-2" aria-hidden="true" tabindex="-1"></a>[<span class="fl">1</span> <span class="op">/</span> x <span class="kw">for</span> x <span class="kw">in</span> p.freq[big_perio][<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>]]</span></code></pre></div>
<pre><code>3-element Array{Float64,1}:
  12.0
 240.0
  60.0</code></pre>
<p>So, the most important peak correspond to one cycle every <span class="math inline">\(12\)</span>, <span class="math inline">\(240\)</span> and <span class="math inline">\(60\)</span> months. The cycle every <span class="math inline">\(60\)</span> months (five years) reflect the El Nino effect. The one that appears every <span class="math inline">\(240\)</span> months (<span class="math inline">\(20\)</span> years) may reflect a particularly important and intense El Nino effect.</p>
</div>
<div id="exercise-2.10" class="section level3" number="3.1.10">
<h3><span class="header-section-number">3.1.10</span> Exercise 2.10</h3>
<div class="sourceCode" id="cb79"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb79-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb79-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb79-2" aria-hidden="true" tabindex="-1"></a>gas <span class="op">=</span> load(<span class="st">&quot;../data/gas.rda&quot;</span>)[<span class="st">&quot;gas&quot;</span>]<span class="op">;</span></span>
<span id="cb79-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb79-3" aria-hidden="true" tabindex="-1"></a>oil <span class="op">=</span> load(<span class="st">&quot;../data/oil.rda&quot;</span>)[<span class="st">&quot;oil&quot;</span>]<span class="op">;</span></span></code></pre></div>
<ul>
<li><em>Question (a)</em></li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb80-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb80-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb80-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-3" aria-hidden="true" tabindex="-1"></a>plot(gas<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Gas&quot;</span>)</span>
<span id="cb80-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-4" aria-hidden="true" tabindex="-1"></a>plot(oil<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Oil&quot;</span>)</span>
<span id="cb80-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-5" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Week&quot;</span>)</span>
<span id="cb80-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-6" aria-hidden="true" tabindex="-1"></a>legend()</span>
<span id="cb80-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-7" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Gas and Oil series&quot;</span>)</span>
<span id="cb80-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb80-8" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_72_0.png" /></p>
<p>These series resemble the most to random walks with linear trends. The series are probably not stationary, because their mean functions depend on time.</p>
<ul>
<li><em>Question (b)</em></li>
</ul>
<p>The transformation <span class="math inline">\(y_t = \nabla \log x_t\)</span> is an approximation of the return <span class="math inline">\(\nabla x_t / x_t\)</span> when <span class="math inline">\(x_t\)</span> is small. The computation with the log is probably more stable.</p>
<ul>
<li><em>Question (c)</em></li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb81-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb81-1" aria-hidden="true" tabindex="-1"></a>gas_log <span class="op">=</span> [log(x) <span class="kw">for</span> x <span class="kw">in</span> gas]<span class="op">;</span></span>
<span id="cb81-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb81-2" aria-hidden="true" tabindex="-1"></a>oil_log <span class="op">=</span> [log(x) <span class="kw">for</span> x <span class="kw">in</span> oil]<span class="op">;</span></span>
<span id="cb81-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb81-3" aria-hidden="true" tabindex="-1"></a>gas_r <span class="op">=</span> gas_log[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>] <span class="op">-</span> gas_log[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">1</span>]<span class="op">;</span></span>
<span id="cb81-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb81-4" aria-hidden="true" tabindex="-1"></a>oil_r <span class="op">=</span> oil_log[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>] <span class="op">-</span> oil_log[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">1</span>]<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb82-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb82-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb82-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-3" aria-hidden="true" tabindex="-1"></a>plot(gas_r<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Gas&quot;</span>)</span>
<span id="cb82-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-4" aria-hidden="true" tabindex="-1"></a>plot(oil_r<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Oil&quot;</span>)</span>
<span id="cb82-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-5" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Week&quot;</span>)</span>
<span id="cb82-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-6" aria-hidden="true" tabindex="-1"></a>legend()</span>
<span id="cb82-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-7" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Returned Gas and Oil series&quot;</span>)</span>
<span id="cb82-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb82-8" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_75_0.png" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb83-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ACF for gas return</span></span>
<span id="cb83-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb83-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb83-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb83-3" aria-hidden="true" tabindex="-1"></a>stem(<span class="fl">0</span><span class="op">:</span><span class="fl">543</span><span class="op">,</span> autocor(gas_r<span class="op">,</span> <span class="fl">0</span><span class="op">:</span><span class="fl">543</span>)<span class="op">,</span> use_line_collection<span class="op">=</span><span class="ex">true</span>)</span>
<span id="cb83-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb83-4" aria-hidden="true" tabindex="-1"></a>hlines([<span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">544</span>)<span class="op">,</span> <span class="op">-</span><span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">544</span>)]<span class="op">,</span> xmin<span class="op">=</span><span class="fl">0</span><span class="op">,</span> xmax<span class="op">=</span><span class="fl">544</span><span class="op">,</span> colors<span class="op">=</span><span class="st">&quot;red&quot;</span><span class="op">,</span> linestyles<span class="op">=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb83-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb83-5" aria-hidden="true" tabindex="-1"></a>xlabel(L<span class="st">&quot;$h$&quot;</span>)</span>
<span id="cb83-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb83-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Autocorrelation function for Gas&quot;</span>)</span>
<span id="cb83-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb83-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_76_0.png" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb84-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ACF for oil return</span></span>
<span id="cb84-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb84-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb84-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb84-3" aria-hidden="true" tabindex="-1"></a>stem(<span class="fl">0</span><span class="op">:</span><span class="fl">543</span><span class="op">,</span> autocor(oil_r<span class="op">,</span> <span class="fl">0</span><span class="op">:</span><span class="fl">543</span>)<span class="op">,</span> use_line_collection<span class="op">=</span><span class="ex">true</span>)</span>
<span id="cb84-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb84-4" aria-hidden="true" tabindex="-1"></a>hlines([<span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">544</span>)<span class="op">,</span> <span class="op">-</span><span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">544</span>)]<span class="op">,</span> xmin<span class="op">=</span><span class="fl">0</span><span class="op">,</span> xmax<span class="op">=</span><span class="fl">544</span><span class="op">,</span> colors<span class="op">=</span><span class="st">&quot;red&quot;</span><span class="op">,</span> linestyles<span class="op">=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb84-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb84-5" aria-hidden="true" tabindex="-1"></a>xlabel(L<span class="st">&quot;$h$&quot;</span>)</span>
<span id="cb84-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb84-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Autocorrelation function for Oil&quot;</span>)</span>
<span id="cb84-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb84-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_77_0.png" /></p>
<p>The transformation of the data make the series stationary. The correlation between the Gas and Oil series is likely to be high.</p>
<ul>
<li><em>Question (d)</em></li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb85-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the CCF for oil return</span></span>
<span id="cb85-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb85-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb85-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb85-3" aria-hidden="true" tabindex="-1"></a>stem(<span class="fl">0</span><span class="op">:</span><span class="fl">543</span><span class="op">,</span> crosscor(gas_r<span class="op">,</span> oil_r<span class="op">,</span> <span class="fl">0</span><span class="op">:</span><span class="fl">543</span>)<span class="op">,</span> use_line_collection<span class="op">=</span><span class="ex">true</span>)</span>
<span id="cb85-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb85-4" aria-hidden="true" tabindex="-1"></a>hlines([<span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">544</span>)<span class="op">,</span> <span class="op">-</span><span class="fl">1.96</span> <span class="op">/</span> sqrt(<span class="fl">544</span>)]<span class="op">,</span> xmin<span class="op">=</span><span class="fl">0</span><span class="op">,</span> xmax<span class="op">=</span><span class="fl">544</span><span class="op">,</span> colors<span class="op">=</span><span class="st">&quot;red&quot;</span><span class="op">,</span> linestyles<span class="op">=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb85-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb85-5" aria-hidden="true" tabindex="-1"></a>xlabel(L<span class="st">&quot;$h$&quot;</span>)</span>
<span id="cb85-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb85-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Cross-correlation function between Oil and Gas series&quot;</span>)</span>
<span id="cb85-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb85-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_79_0.png" /></p>
<p>The correlation when <span class="math inline">\(h = 0\)</span> is high (around <span class="math inline">\(0.7\)</span>) and indicate the influence between the two series. Moreover, the small correlation values when gas leads oil is significant.</p>
<ul>
<li><em>Question (e)</em></li>
</ul>
<div class="sourceCode" id="cb86"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb86-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-1" aria-hidden="true" tabindex="-1"></a>x_pred <span class="op">=</span> range(extrema(gas_r)<span class="op">...;</span> step <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb86-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> figure(figsize<span class="op">=</span>(<span class="fl">20</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb86-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-4" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">141</span>)</span>
<span id="cb86-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> scatter(gas_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span>])</span>
<span id="cb86-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> loess(gas_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span>])</span>
<span id="cb86-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-7" aria-hidden="true" tabindex="-1"></a>plot(x_pred<span class="op">,</span> Loess.predict(model<span class="op">,</span> x_pred)<span class="op">,</span> c<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb86-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-8" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Gas growth rate&quot;</span>)</span>
<span id="cb86-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-9" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Oil growth rate&quot;</span>)</span>
<span id="cb86-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-11" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">142</span>)</span>
<span id="cb86-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> scatter(gas_r[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">1</span>])</span>
<span id="cb86-13"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-13" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> loess(gas_r[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">1</span>])</span>
<span id="cb86-14"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-14" aria-hidden="true" tabindex="-1"></a>plot(x_pred<span class="op">,</span> Loess.predict(model<span class="op">,</span> x_pred)<span class="op">,</span> c<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb86-15"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-15" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Gas growth rate&quot;</span>)</span>
<span id="cb86-16"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-16" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Oil growth rate one week prior&quot;</span>)</span>
<span id="cb86-17"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-18"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-18" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">143</span>)</span>
<span id="cb86-19"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-19" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> scatter(gas_r[<span class="fl">3</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">2</span>])</span>
<span id="cb86-20"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-20" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> loess(gas_r[<span class="fl">3</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">2</span>])</span>
<span id="cb86-21"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-21" aria-hidden="true" tabindex="-1"></a>plot(x_pred<span class="op">,</span> Loess.predict(model<span class="op">,</span> x_pred)<span class="op">,</span> c<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb86-22"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-22" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Gas growth rate&quot;</span>)</span>
<span id="cb86-23"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-23" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Oil growth rate two week prior&quot;</span>)</span>
<span id="cb86-24"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-25" aria-hidden="true" tabindex="-1"></a>subplot(<span class="fl">144</span>)</span>
<span id="cb86-26"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-26" aria-hidden="true" tabindex="-1"></a>p4 <span class="op">=</span> scatter(gas_r[<span class="fl">4</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">3</span>])</span>
<span id="cb86-27"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-27" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> loess(gas_r[<span class="fl">4</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">-</span> <span class="fl">3</span>])</span>
<span id="cb86-28"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-28" aria-hidden="true" tabindex="-1"></a>plot(x_pred<span class="op">,</span> Loess.predict(model<span class="op">,</span> x_pred)<span class="op">,</span> c<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb86-29"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-29" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Gas growth rate&quot;</span>)</span>
<span id="cb86-30"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-30" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Oil growth rate three week prior&quot;</span>)</span>
<span id="cb86-31"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-32"><a href="time-series-regression-and-exploratory-data-analysis.html#cb86-32" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_81_0.png" /></p>
<p>We have fit the data using the lowess method, related to nearest neighbor regression. We can see few outliers in the data. Only the first model exhibit almost linear relationship.</p>
<ul>
<li><em>Question (f)</em></li>
</ul>
<p>Consider the model
<span class="math display">\[G_t = \alpha_1 + \alpha_2 I_t + \beta_1 O_t + \beta_2 O_{t-1} + w_t,\]</span>
where <span class="math inline">\(I_t = 1\)</span> if <span class="math inline">\(O_t \geq 0\)</span> and <span class="math inline">\(0\)</span> otherwise. <span class="math inline">\(I_t\)</span> is the indicator of no growth or positive growth in oil price.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb87-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb87-1" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span> [x <span class="op">&gt;</span> <span class="fl">0</span> <span class="kw">for</span> x <span class="kw">in</span> oil_r]</span>
<span id="cb87-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb87-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> DataFrame(G<span class="op">=</span>gas_r[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> I<span class="op">=</span>I[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> O<span class="op">=</span>oil_r[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> O_lag<span class="op">=</span>oil_r[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span><span class="fl">1</span>])<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb88-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model</span></span>
<span id="cb88-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb88-2" aria-hidden="true" tabindex="-1"></a>lm_model <span class="op">=</span> lm(<span class="pp">@formula</span>(G <span class="op">~</span> I <span class="op">+</span> O <span class="op">+</span> O_lag)<span class="op">,</span> data)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb89-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb89-1" aria-hidden="true" tabindex="-1"></a>lm_model</span></code></pre></div>
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Array{Float64,1}},GLM.DensePredChol{Float64,Cholesky{Float64,Array{Float64,2}}}},Array{Float64,2}}

G ~ 1 + I + O + O_lag

Coefficients:
────────────────────────────────────────────────────────────────────────────────
                   Coef.  Std. Error      t  Pr(&gt;|t|)     Lower 95%    Upper 95%
────────────────────────────────────────────────────────────────────────────────
(Intercept)  -0.00610993  0.00345539  -1.77    0.0776  -0.0128976    0.000677756
I             0.0117854   0.00551434   2.14    0.0330   0.000953159  0.0226176
O             0.687749    0.0583795   11.78    &lt;1e-27   0.57307      0.802429
O_lag         0.112152    0.0385698    2.91    0.0038   0.0363868    0.187918
────────────────────────────────────────────────────────────────────────────────</code></pre>
<p>The fitted model when there is negative growth in oil price at time <span class="math inline">\(t\)</span> is
<span class="math display">\[G_t = -0.006 + 0.68 O_t + 0.11 O_{t-1}.\]</span>
The fitted model when there is no or positive growth in oil price at time <span class="math inline">\(t\)</span> is
<span class="math display">\[G_t = 0.0057 + 0.68 O_t + 0.11 O_{t-1}.\]</span></p>
<p>Thus, the model is (almost) symetric considering the indicator of growth in oil price. The asymmetry assumption does not seem to hold here.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb91-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb91-1" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb91-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb91-2" aria-hidden="true" tabindex="-1"></a>plot(gas_r[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Gas&quot;</span>)</span>
<span id="cb91-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb91-3" aria-hidden="true" tabindex="-1"></a>plot(StatsBase.predict(lm_model)<span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Prediction&quot;</span>)</span>
<span id="cb91-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb91-4" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Week&quot;</span>)</span>
<span id="cb91-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb91-5" aria-hidden="true" tabindex="-1"></a>legend()</span>
<span id="cb91-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb91-6" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Returned Gas and its prediction&quot;</span>)</span>
<span id="cb91-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb91-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_87_0.png" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb92-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb92-1" aria-hidden="true" tabindex="-1"></a>resid <span class="op">=</span> gas_r[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>] <span class="op">-</span> StatsBase.predict(lm_model)</span>
<span id="cb92-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb92-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb92-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb92-4" aria-hidden="true" tabindex="-1"></a>scatter(<span class="fl">1</span><span class="op">:</span><span class="fl">543</span><span class="op">,</span> resid)</span>
<span id="cb92-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb92-5" aria-hidden="true" tabindex="-1"></a>xlabel(L<span class="st">&quot;$t$&quot;</span>)</span>
<span id="cb92-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb92-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb92-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb92-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_88_0.png" /></p>
<p>The residuals appear to be normal, and look the original series. Don’t know how to analyze that.</p>
</div>
<div id="exercise-2.11" class="section level3" number="3.1.11">
<h3><span class="header-section-number">3.1.11</span> Exercise 2.11</h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb93-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb93-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb93-2" aria-hidden="true" tabindex="-1"></a>globtemp <span class="op">=</span> load(<span class="st">&quot;../data/globtemp.rda&quot;</span>)[<span class="st">&quot;globtemp&quot;</span>]<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb94-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> filter_convolution(x<span class="op">,</span> filter<span class="op">,</span> sides)</span>
<span id="cb94-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-2" aria-hidden="true" tabindex="-1"></a>    nx <span class="op">=</span> length(x)</span>
<span id="cb94-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-3" aria-hidden="true" tabindex="-1"></a>    nf <span class="op">=</span> length(filter)</span>
<span id="cb94-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-5" aria-hidden="true" tabindex="-1"></a>    nshift <span class="op">=</span> (sides <span class="op">==</span> <span class="fl">1</span>) ? <span class="fl">0</span> <span class="op">:</span> div(nf<span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb94-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-7" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="dt">Array</span>{<span class="dt">Float64</span>}(<span class="cn">undef</span><span class="op">,</span> nx)</span>
<span id="cb94-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>nx</span>
<span id="cb94-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-9" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb94-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> (i <span class="op">+</span> nshift <span class="op">-</span> nf <span class="op">&lt;</span> <span class="fl">0</span>) <span class="op">||</span> (i <span class="op">+</span> nshift <span class="op">&gt;</span> nx)</span>
<span id="cb94-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-11" aria-hidden="true" tabindex="-1"></a>            out[i] <span class="op">=</span> <span class="cn">NaN</span></span>
<span id="cb94-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">continue</span></span>
<span id="cb94-13"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb94-14"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> j <span class="kw">in</span> (max(<span class="fl">1</span><span class="op">,</span> i <span class="op">+</span> nshift <span class="op">-</span> nx))<span class="op">:</span>(min(nf<span class="op">,</span> i <span class="op">+</span> nshift <span class="op">-</span> <span class="fl">1</span>))</span>
<span id="cb94-15"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-15" aria-hidden="true" tabindex="-1"></a>            tmp <span class="op">=</span> x[i <span class="op">+</span> nshift <span class="op">-</span> j]</span>
<span id="cb94-16"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-16" aria-hidden="true" tabindex="-1"></a>            z <span class="op">+=</span> filter[j] <span class="op">*</span> tmp</span>
<span id="cb94-17"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb94-18"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-18" aria-hidden="true" tabindex="-1"></a>        out[i] <span class="op">=</span> z</span>
<span id="cb94-19"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb94-20"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> out</span>
<span id="cb94-21"><a href="time-series-regression-and-exploratory-data-analysis.html#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<pre><code>filter_convolution (generic function with 1 method)</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb96-1"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-1" aria-hidden="true" tabindex="-1"></a>x_pred <span class="op">=</span> range(extrema(<span class="fl">1</span><span class="op">:</span><span class="fl">136</span>)<span class="op">...;</span> step <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb96-2"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> loess(<span class="fl">1</span><span class="op">:</span><span class="fl">136</span><span class="op">,</span> globtemp)</span>
<span id="cb96-3"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> figure(figsize<span class="op">=</span>(<span class="fl">15</span><span class="op">,</span> <span class="fl">5</span>))</span>
<span id="cb96-5"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> scatter(<span class="fl">1</span><span class="op">:</span><span class="fl">136</span><span class="op">,</span> globtemp<span class="op">,</span> label <span class="op">=</span> <span class="st">&quot;Obs&quot;</span>)</span>
<span id="cb96-6"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-6" aria-hidden="true" tabindex="-1"></a>plot(x_pred<span class="op">,</span> Loess.predict(model<span class="op">,</span> x_pred)<span class="op">,</span> c<span class="op">=</span><span class="st">&quot;r&quot;</span><span class="op">,</span> label <span class="op">=</span> <span class="st">&quot;Loess&quot;</span>)</span>
<span id="cb96-7"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-7" aria-hidden="true" tabindex="-1"></a>plot(<span class="fl">1</span><span class="op">:</span><span class="fl">136</span><span class="op">,</span> filter_convolution(globtemp<span class="op">,</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">0.25</span><span class="op">,</span> <span class="fl">0.25</span><span class="op">,</span> <span class="fl">0.25</span>]<span class="op">,</span> <span class="fl">2</span>)<span class="op">,</span> c<span class="op">=</span><span class="st">&quot;g&quot;</span><span class="op">,</span> label<span class="op">=</span><span class="st">&quot;Moving Average&quot;</span>)</span>
<span id="cb96-8"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-8" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">&quot;Years&quot;</span>)</span>
<span id="cb96-9"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-9" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">&quot;Temperature deviations&quot;</span>)</span>
<span id="cb96-10"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-10" aria-hidden="true" tabindex="-1"></a>legend()</span>
<span id="cb96-11"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-11" aria-hidden="true" tabindex="-1"></a>title(<span class="st">&quot;Global mean land-ocean temperature deviations to 2015&quot;</span>)</span>
<span id="cb96-12"><a href="time-series-regression-and-exploratory-data-analysis.html#cb96-12" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre></div>
<p><img src="figures/02-time-series-regression/output_93_0.png" /></p>
<p>We see an increasing linear trend in the data. The two smoothing methods exhibit different results. The loess method results in a smoother estimation of the trend.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="characteristics-of-time-series.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
